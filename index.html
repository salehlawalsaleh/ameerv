<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Authentication</title>

  <!-- Fonts + Font Awesome for icons -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-p1Cm6Y9K6Qe5j7G2y6r6Zg0Qkz1q3b9gkM3Y1P1YJ0gqQ+5x1JZ0+JxjF5rK7qV0J9yLz2bY0pE6v7q1l9Qxw==" crossorigin="anonymous" referrerpolicy="no-referrer" />

  <style>
    :root{
      --bg:#f4f6f8; --card:#fff; --ink:#0f172a; --muted:#64748b;
      --brand:#0ea5a0; --brand-2:#007f5f; --danger:#ef4444;
      --glass: rgba(255,255,255,0.7);
    }
    *{box-sizing:border-box}
    body{
      font-family: Inter, system-ui, sans-serif;
      background: linear-gradient(180deg,#f8fafb 0%, #eef2f4 100%);
      margin:0; padding:24px; display:flex; align-items:center; justify-content:center; min-height:100vh; color:var(--ink);
    }
    .card{
      background:var(--card);
      border-radius:16px;
      box-shadow: 0 10px 30px rgba(2,8,23,0.08);
      padding: 20px;
      max-width: 420px;
      width: 100%;
      position: relative;
      overflow: hidden;
    }

    /* Brand heading (Verify Me) */
    .brand {
      text-align:center;
      font-size:14px;
      font-weight:800;
      color:var(--brand-2);
      margin: 0 0 8px 0;
      letter-spacing: 0.6px;
    }

    h2 { text-align:center; font-weight:800; margin:6px 0 12px; font-size:20px; color:var(--ink) }

    /* Toggle switch */
    .toggle {
      display:flex;
      background: #eef2f4;
      border-radius: 999px;
      padding:4px;
      gap:4px;
      width: 240px;
      margin: 0 auto 18px;
      align-items:center;
      justify-content:space-between;
    }
    .toggle button {
      flex:1;
      padding:8px 12px;
      border-radius: 999px;
      border: none;
      background: transparent;
      cursor:pointer;
      font-weight:700;
      color:var(--muted);
      transition: all .18s ease;
    }
    .toggle button.active {
      background: linear-gradient(135deg,var(--brand-2),var(--brand));
      color: #fff;
      box-shadow: 0 6px 18px rgba(2,8,23,0.08);
    }

    .small { font-size:13px; color:var(--muted); text-align:center; margin-top:10px }
    footer { text-align:center; margin-top:16px; font-size:13px; color:var(--muted) }
    a { color:var(--brand-2); text-decoration:none }
    a:hover { text-decoration:underline }

    /* modern input styling */
    .field {
      position: relative;
      margin-bottom: 14px;
    }
    .field .fa-icon {
      position: absolute;
      left: 12px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--muted);
      font-size: 14px;
      pointer-events: none;
    }
    input {
      width:100%;
      padding:12px 14px 12px 40px; /* space for icon */
      border-radius:12px;
      border: 1px solid #e6edf0;
      background: #fff;
      font-size:15px;
      transition: box-shadow .16s ease, border-color .16s ease, transform .08s ease;
      box-shadow: 0 1px 0 rgba(2,6,23,0.02);
    }
    input::placeholder { color: #9aa7b0; opacity:1; }
    input:focus {
      outline: none;
      border-color: var(--brand);
      box-shadow: 0 10px 30px rgba(14,165,160,0.06);
      transform: translateY(-1px);
    }
    /* subtle eye toggle for passwords */
    .toggle-pass {
      position: absolute;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
      background: transparent;
      border: none;
      color: var(--muted);
      cursor: pointer;
      font-size: 14px;
      padding: 6px;
    }

    .row { display:grid; gap:8px; }
    .actions { margin-top:6px; display:flex; gap:10px; align-items:center }
    .btn {
      flex:1;
      padding:12px;
      border-radius:10px;
      border:none;
      color:#fff;
      font-weight:800;
      background: linear-gradient(135deg,var(--brand-2),var(--brand));
      cursor:pointer;
    }
    .btn.secondary {
      background:transparent; color:var(--brand-2); border:1px solid rgba(6,95,79,0.08); font-weight:700;
    }

    .error { color:var(--danger); text-align:center; margin-bottom:8px; font-weight:700; min-height:18px }

    @media (max-width:420px){
      .toggle { width: 100% }
    }

    /* === Toast styles (copied from dashboard) === */
    #toast-container {
      position: fixed;
      right: 20px;
      bottom: 20px;
      z-index: 2000;
      display: flex;
      flex-direction: column;
      gap: 10px;
      align-items: flex-end;
      pointer-events: none;
    }
    .toast {
      min-width: 220px;
      max-width: 360px;
      background: #ffffff;
      color: #0f172a;
      padding: 12px 14px;
      border-radius: 10px;
      box-shadow: 0 6px 18px rgba(2,6,23,0.12);
      display: flex;
      gap: 12px;
      align-items: center;
      font-size: 0.95rem;
      pointer-events: auto;
      border-left: 4px solid transparent;
      transform-origin: 100% 100%;
      animation: toast-in 260ms ease-out;
    }
    .toast .icon { width: 36px; height: 36px; border-radius: 8px; display: grid; place-items: center; font-weight: 700; font-size: 18px; }
    .toast.info { border-left-color: #0ea5e9; }
    .toast.success { border-left-color: #10b981; }
    .toast.error { border-left-color: #ef4444; }
    .toast.info .icon { background: rgba(14,165,233,0.08); color: #0369a1; }
    .toast.success .icon { background: rgba(16,185,129,0.08); color: #065f46; }
    .toast.error .icon { background: rgba(239,68,68,0.08); color: #7f1d1d; }
    .toast .content { flex: 1; text-align: left; }
    .toast .close-btn { background: transparent; border: none; cursor: pointer; font-size: 14px; opacity: 0.7; padding: 4px; }
    .toast .close-btn:hover { opacity: 1; }

    @keyframes toast-in { from { transform: translateY(10px) scale(.98); opacity: 0; } to { transform: translateY(0) scale(1); opacity: 1; } }
    @keyframes toast-out { from { transform: translateY(0) scale(1); opacity: 1; } to { transform: translateY(10px) scale(.98); opacity: 0; } }
  </style>
</head>
<body>

  <div class="card" role="main" aria-labelledby="formTitle">
    <!-- Added Verify Me brand heading -->
    <div class="brand">Verify Me</div>
    <h2 id="formTitle">Create Account</h2>

    <!-- modern toggle -->
    <div class="toggle" role="tablist" aria-label="Switch between register and login">
      <button id="toggleRegister" class="active" role="tab" aria-selected="true">Register</button>
      <button id="toggleLogin" role="tab" aria-selected="false">Login</button>
    </div>

    <!-- kept errorBox for a11y (not used visually) -->
    <div id="errorBox" class="error" aria-live="polite" style="display:none"></div>

    <!-- Register form -->
    <form id="registerForm" autocomplete="on">
      <div class="field">
        <i class="fa-solid fa-user fa-icon" aria-hidden="true"></i>
        <input id="regName" name="regName" type="text" placeholder="Full name" required />
      </div>

      <div class="field">
        <i class="fa-solid fa-envelope fa-icon" aria-hidden="true"></i>
        <input id="regEmail" name="regEmail" type="email" placeholder="you@example.com" required />
      </div>

      <div class="field">
        <i class="fa-solid fa-lock fa-icon" aria-hidden="true"></i>
        <input id="regPassword" name="regPassword" type="password" placeholder="Create a strong password" required />
        <button type="button" class="toggle-pass" aria-label="Toggle password visibility" data-target="regPassword">
          <i class="fa-regular fa-eye"></i>
        </button>
      </div>

      <div class="field">
        <i class="fa-solid fa-lock fa-icon" aria-hidden="true"></i>
        <input id="regConfirm" name="regConfirm" type="password" placeholder="Confirm password" required />
        <button type="button" class="toggle-pass" aria-label="Toggle password visibility" data-target="regConfirm">
          <i class="fa-regular fa-eye"></i>
        </button>
      </div>

      <div class="actions">
        <button id="registerBtn" type="button" class="btn">Create account</button>
      </div>
    </form>

    <!-- Login form (hidden initially) -->
    <form id="loginForm" style="display:none" autocomplete="on">
      <div class="field">
        <i class="fa-solid fa-envelope fa-icon" aria-hidden="true"></i>
        <input id="logEmail" name="logEmail" type="email" placeholder="you@example.com" required />
      </div>

      <div class="field">
        <i class="fa-solid fa-lock fa-icon" aria-hidden="true"></i>
        <input id="logPassword" name="logPassword" type="password" placeholder="••••••" required />
        <button type="button" class="toggle-pass" aria-label="Toggle password visibility" data-target="logPassword">
          <i class="fa-regular fa-eye"></i>
        </button>
      </div>

      <div class="actions">
        <button id="loginBtn" type="button" class="btn">Login</button>
        <button id="toRegisterBtn" type="button" class="btn secondary">Register</button>
      </div>
    </form>

    <div class="small">
      <a href="https://wa.me/2348145415083" target="_blank" rel="noopener">Forgot password? Contact support</a>
    </div>

    <footer>
      <div style="margin-top:8px; color:var(--muted)">By continuing you agree to our terms.</div>
    </footer>
  </div>

  <!-- Toast container (dashboard-style) -->
  <div id="toast-container" aria-live="polite" aria-atomic="true"></div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import {
    getAuth,
    createUserWithEmailAndPassword,
    signInWithEmailAndPassword,
    updateProfile,
    onAuthStateChanged,
    setPersistence,
    browserLocalPersistence
  } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
  import { getDatabase, ref, set } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

  // === Firebase config (keep same as your project) ===
  const firebaseConfig = {
    apiKey: "AIzaSyDc0bIipHU7N73mju33dNwSWmH3IeIYkog",
    authDomain: "ameernin-ba310.firebaseapp.com",
    databaseURL: "https://ameernin-ba310-default-rtdb.firebaseio.com",
    projectId: "ameernin-ba310",
    storageBucket: "ameernin-ba310.appspot.com",
    messagingSenderId: "522206845073",
    appId: "1:522206845073:web:3c85714bd7eda6c1048730",
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getDatabase(app);

  /* ======= Toast utility (dashboard-style) ======= */
  function showToast(message, type = "info", duration = 3500) {
    try {
      const container = document.getElementById('toast-container');
      if (!container) return;
      const toast = document.createElement('div');
      toast.className = `toast ${type}`;

      const icon = document.createElement('div');
      icon.className = 'icon';
      icon.innerText = type === 'success' ? '✓' : (type === 'error' ? '!' : 'i');

      const content = document.createElement('div');
      content.className = 'content';
      content.innerText = message;

      const closeBtn = document.createElement('button');
      closeBtn.className = 'close-btn';
      closeBtn.setAttribute('aria-label', 'Close notification');
      closeBtn.innerText = '×';
      closeBtn.onclick = () => removeToast(toast);

      toast.appendChild(icon);
      toast.appendChild(content);
      toast.appendChild(closeBtn);

      container.appendChild(toast);

      const timeoutId = setTimeout(() => { removeToast(toast); }, duration);

      toast.addEventListener('click', (e) => { if (e.target !== closeBtn) removeToast(toast); clearTimeout(timeoutId); });

      function removeToast(el) {
        el.style.animation = 'toast-out 200ms ease-in';
        el.style.opacity = '0';
        setTimeout(() => { if (el && el.parentNode) el.parentNode.removeChild(el); }, 220);
      }
    } catch (err) { console.error('toast error', err); }
  }

  // Elements
  const toggleRegister = document.getElementById('toggleRegister');
  const toggleLogin = document.getElementById('toggleLogin');
  const registerForm = document.getElementById('registerForm');
  const loginForm = document.getElementById('loginForm');
  const errorBox = document.getElementById('errorBox');
  const formTitle = document.getElementById('formTitle');
  const toRegisterBtn = document.getElementById('toRegisterBtn');

  // Toggle handlers (also update formTitle but keep brand heading)
  function showRegister() {
    toggleRegister.classList.add('active');
    toggleLogin.classList.remove('active');
    registerForm.style.display = 'block';
    loginForm.style.display = 'none';
    formTitle.textContent = 'Create Account';
    errorBox.textContent = '';
    toggleRegister.setAttribute('aria-selected','true');
    toggleLogin.setAttribute('aria-selected','false');
  }
  function showLogin() {
    toggleLogin.classList.add('active');
    toggleRegister.classList.remove('active');
    registerForm.style.display = 'none';
    loginForm.style.display = 'block';
    formTitle.textContent = 'Welcome back';
    errorBox.textContent = '';
    toggleLogin.setAttribute('aria-selected','true');
    toggleRegister.setAttribute('aria-selected','false');
  }
  toggleRegister.addEventListener('click', showRegister);
  toggleLogin.addEventListener('click', showLogin);
  toRegisterBtn.addEventListener('click', showRegister);

  // Keep auth persistence (local) so login survives browser close
  setPersistence(auth, browserLocalPersistence).catch(()=>{ /* ignore */ });

  // Auth state - save to localStorage for dashboard (no visual change here)
  onAuthStateChanged(auth, (user) => {
    if (user) {
      const userData = {
        userId: user.uid,
        username: user.displayName || user.email.split("@")[0],
        email: user.email,
      };
      localStorage.setItem("user", JSON.stringify(userData));
      localStorage.setItem("userId", userData.userId);
      localStorage.setItem("username", userData.username);
    } else {
      // do nothing here
    }
  });

  // helper: show error via toast (and keep a11y container text)
  function showError(msg) {
    // set hidden errorBox for screen readers
    if (errorBox) {
      errorBox.style.display = 'block';
      errorBox.textContent = msg;
      setTimeout(() => { errorBox.style.display = 'none'; }, 2000);
    }
    showToast(msg, 'error', 4200);
  }

  // Register handler
  document.getElementById('registerBtn').addEventListener('click', async () => {
    const name = document.getElementById('regName').value.trim();
    const email = document.getElementById('regEmail').value.trim();
    const pass = document.getElementById('regPassword').value;
    const confirm = document.getElementById('regConfirm').value;

    if (!name || !email || !pass) {
      showError('Please fill all fields.');
      return;
    }
    if (pass !== confirm) {
      showError('Passwords do not match.');
      return;
    }

    try {
      const cred = await createUserWithEmailAndPassword(auth, email, pass);
      // set displayName
      await updateProfile(cred.user, { displayName: name }).catch(()=>{});
      // create DB record
      await set(ref(db, 'users/' + cred.user.uid), {
        name,
        email,
        balance: 0,
        demoCount: 0,
        createdAt: Date.now()
      });
      showToast("Account created. Redirecting...", "success", 1200);
      // localStorage will be set by onAuthStateChanged
      setTimeout(() => { window.location.href = 'dashboard.html'; }, 900);
    } catch (e) {
      console.error(e);
      showError(e.message || 'Registration failed');
    }
  });

  // Login handler
  document.getElementById('loginBtn').addEventListener('click', async () => {
    const email = document.getElementById('logEmail').value.trim();
    const pass = document.getElementById('logPassword').value;
    if (!email || !pass) {
      showError('Please enter email and password.');
      return;
    }
    try {
      await signInWithEmailAndPassword(auth, email, pass);
      showToast("Login successful. Redirecting...", "success", 900);
      setTimeout(() => { window.location.href = 'dashboard.html'; }, 700);
    } catch (e) {
      console.error(e);
      showError(e.message || 'Login failed');
    }
  });

  // Small improvement: keyboard Enter submits proper action
  document.getElementById('registerForm').addEventListener('keydown', (e) => {
    if (e.key === 'Enter') { e.preventDefault(); document.getElementById('registerBtn').click(); }
  });
  document.getElementById('loginForm').addEventListener('keydown', (e) => {
    if (e.key === 'Enter') { e.preventDefault(); document.getElementById('loginBtn').click(); }
  });

  /* ======= Password visibility toggles (for the modern inputs) ======= */
  document.querySelectorAll('.toggle-pass').forEach(btn => {
    btn.addEventListener('click', () => {
      const id = btn.getAttribute('data-target');
      const input = document.getElementById(id);
      if (!input) return;
      if (input.type === 'password') {
        input.type = 'text';
        btn.innerHTML = '<i class="fa-regular fa-eye-slash"></i>';
      } else {
        input.type = 'password';
        btn.innerHTML = '<i class="fa-regular fa-eye"></i>';
      }
    });
  });
</script>
</body>
</html>
